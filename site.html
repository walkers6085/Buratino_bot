<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π - –ó–≤–µ–∑–¥–Ω–æ–µ –Ω–µ–±–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: radial-gradient(ellipse at center, #0c1445 0%, #000 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .app-container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .title {
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(45deg, #00d4ff, #ff00d4, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .search-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(0, 212, 255, 0.5);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            font-size: 16px;
            width: 300px;
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .search-btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.7);
        }

        .market-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 14px;
            opacity: 0.8;
        }

        .galaxy-container {
            position: relative;
            min-height: 80vh;
            padding: 50px;
        }

        .galaxy {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 8s infinite ease-in-out;
        }

        .galaxy:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .galaxy.oil-sector {
            background: radial-gradient(circle, rgba(255, 100, 0, 0.3) 0%, transparent 70%);
        }

        .galaxy.tech-sector {
            background: radial-gradient(circle, rgba(0, 255, 100, 0.3) 0%, transparent 70%);
        }

        .galaxy.finance-sector {
            background: radial-gradient(circle, rgba(100, 100, 255, 0.3) 0%, transparent 70%);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(20px) rotate(-5deg); }
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }

        .planet:hover {
            transform: scale(1.2);
            z-index: 50;
        }

        .planet.high-correlation {
            background: radial-gradient(circle, #ff6b6b, #ee5a52);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
        }

        .planet.medium-correlation {
            background: radial-gradient(circle, #feca57, #ff9ff3);
            box-shadow: 0 0 15px rgba(254, 202, 87, 0.6);
        }

        .planet.low-correlation {
            background: radial-gradient(circle, #48dbfb, #0abde3);
            box-shadow: 0 0 15px rgba(72, 219, 251, 0.6);
        }

        .satellite {
            position: absolute;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 8px white;
            animation: orbit 10s linear infinite;
        }

        @keyframes orbit {
            from { transform: rotate(0deg) translateX(40px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(40px) rotate(-360deg); }
        }

        .info-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border-left: 2px solid rgba(0, 212, 255, 0.5);
            padding: 30px;
            transition: right 0.5s ease;
            overflow-y: auto;
            z-index: 200;
        }

        .info-panel.open {
            right: 0;
        }

        .close-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .pair-info {
            margin-bottom: 30px;
        }

        .pair-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .correlation-value {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .correlation-high {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .correlation-medium {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
        }

        .correlation-low {
            background: linear-gradient(45deg, #48dbfb, #0abde3);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .chart {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #00d4ff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .info-panel {
                width: 100%;
                right: -100%;
            }
            
            .search-input {
                width: 200px;
            }
            
            .title {
                font-size: 1.8em;
            }
            
            .galaxy-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <div class="app-container">
        <div class="header">
            <h1 class="title">üåå –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π</h1>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="–ù–∞–π—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: SBER, GAZP)">
                <button class="search-btn" onclick="searchInstrument()">üîç –ù–∞–π—Ç–∏</button>
            </div>
            <div class="market-info">
                <span>üìä –î–∞–Ω–Ω—ã–µ MOEX</span>
                <span>üìà –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –∑–∞ 30 –¥–Ω–µ–π</span>
                <span>üïê –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="lastUpdate">–ó–∞–≥—Ä—É–∑–∫–∞...</span></span>
            </div>
        </div>

        <div class="galaxy-container" id="galaxyContainer">
            <div class="loading">
                <div class="spinner"></div>
                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π...
            </div>
        </div>

        <div class="info-panel" id="infoPanel">
            <button class="close-panel" onclick="closeInfoPanel()">‚úï</button>
            <div id="panelContent">
                <div class="pair-info">
                    <div class="pair-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</div>
                    <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏</p>
                </div>
            </div>
        </div>
        <div class="legend">
            <h4 style="margin-bottom: 15px;">üåü –õ–µ–≥–µ–Ω–¥–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                –í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (> 0.7)
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #feca57;"></div>
                –°—Ä–µ–¥–Ω—è—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (0.3-0.7)
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #48dbfb;"></div>
                –ù–∏–∑–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (< 0.3)
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let correlationData = [];
        let sectors = {};
        let selectedInstrument = null;

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤–µ–∑–¥–Ω–æ–≥–æ –Ω–µ–±–∞
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 100;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ JSON —Ñ–∞–π–ª–∞
async function loadRealData() {
    try {
        console.log('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ correlations.json...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–∏ file:// –ø—Ä–æ—Ç–æ–∫–æ–ª
        if (window.location.protocol === 'file:') {
            throw new Error('–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ file:// –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fetch. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, python -m http.server).');
        }

        const response = await fetch('correlations.json', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
        
        if (data.coefficients && data.coefficients.data && Array.isArray(data.coefficients.data) && data.coefficients.data.length > 0) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
            const isValidFormat = data.coefficients.data.every(row => 
                Array.isArray(row) && 
                row.length >= 5 && 
                typeof row[0] === 'string' && // SECID
                typeof row[1] === 'string' && // FXSECID
                typeof row[2] === 'string' && // TRADEDATE
                typeof row[3] === 'number' && // COEFF_CORRELATION
                typeof row[4] === 'number'    // COEFF_BETA
            );
            
            if (!isValidFormat) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ correlations.json: –æ–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ [SECID, FXSECID, TRADEDATE, COEFF_CORRELATION, COEFF_BETA]');
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –æ–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: [instrument1, instrument2, date, correlation, beta]
            correlationData = data.coefficients.data.map(row => [
                row[0], // SECID
                row[1], // FXSECID
                row[2], // TRADEDATE
                row[3], // COEFF_CORRELATION
                row[4]  // COEFF_BETA
            ]);
            console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${correlationData.length} –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –∏–∑ —Ñ–∞–π–ª–∞`);
            
            updateSectorsFromRealData();
            createGalaxies();
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString() + ' (–∏–∑ —Ñ–∞–π–ª–∞)';
            
            // –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
            document.querySelector('.loading')?.remove();
        } else {
            throw new Error('–î–∞–Ω–Ω—ã–µ –≤ correlations.json –ø—É—Å—Ç—ã –∏–ª–∏ –∏–º–µ—é—Ç –Ω–µ–≤–µ—Ä–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–æ–∂–∏–¥–∞–µ—Ç—Å—è coefficients.data)');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ correlations.json:', error.message);
        let userMessage = '';
        if (error.message.includes('file://')) {
            userMessage = '–û—à–∏–±–∫–∞: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ file:// –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: python -m http.server, –∑–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000';
        } else if (error.message.includes('404')) {
            userMessage = '–§–∞–π–ª correlations.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, —á—Ç–æ –∏ HTML-—Ñ–∞–π–ª.';
        } else {
            userMessage = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`;
        }
        document.getElementById('galaxyContainer').innerHTML = 
            `<div class="loading">‚ùå ${userMessage}</div>`;
        showNotification(userMessage, 'warning');
    }
}

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'warning' ? 'rgba(255, 193, 7, 0.9)' : 'rgba(40, 167, 69, 0.9)'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 1000;
                max-width: 300px;
                font-size: 14px;
                backdrop-filter: blur(10px);
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
            
            if (!document.getElementById('notificationStyles')) {
                const style = document.createElement('style');
                style.id = 'notificationStyles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function updateSectorsFromRealData() {
            const instruments = new Set();
            correlationData.forEach(row => {
                instruments.add(row[0]);
                instruments.add(row[1]);
            });

            const sectorMap = {
                '–ù–µ—Ñ—Ç—å –∏ –≥–∞–∑': ['GAZP', 'LKOH', 'ROSN', 'NVTK', 'TATN', 'SNGS', 'NOVATEK'],
                '–ë–∞–Ω–∫–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã': ['SBER', 'VTBR', 'TCSG', 'MOEX', 'SPBE', 'UPRO'],
                '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏': ['YNDX', 'OZON', 'VKCO', 'HEADHUNTER', 'FIXP'],
                '–ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è': ['MAGN', 'NLMK', 'GMKN', 'PLZL', 'CHMF', 'SEMD'],
                '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': ['AFLT', 'AERO', 'FESH'],
                '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞': ['ROSN', 'IRAO', 'LSRG'],
                '–¢–µ–ª–µ–∫–æ–º': ['MTSS', 'RTKM', 'MGTS'],
                '–†–µ—Ç–µ–π–ª': ['MAGNIT', 'FIVE', 'DIXY']
            };

            const newSectors = {};
            const usedInstruments = new Set();

            Object.entries(sectorMap).forEach(([sectorName, sectorInstruments]) => {
                const foundInstruments = sectorInstruments.filter(inst => 
                    instruments.has(inst) && !usedInstruments.has(inst)
                );
                
                if (foundInstruments.length > 0) {
                    newSectors[sectorName] = {
                        instruments: foundInstruments,
                        color: getSectorColor(sectorName)
                    };
                    foundInstruments.forEach(inst => usedInstruments.add(inst));
                }
            });

            const remainingInstruments = Array.from(instruments).filter(inst => 
                !usedInstruments.has(inst) && inst !== 'IMOEX'
            );

            if (remainingInstruments.length > 0) {
                newSectors['–ü—Ä–æ—á–∏–µ'] = {
                    instruments: remainingInstruments.slice(0, 10),
                    color: 'tech-sector'
                };
            }

            sectors = newSectors;
        }

        function getSectorColor(sectorName) {
            const colorMap = {
                '–ù–µ—Ñ—Ç—å –∏ –≥–∞–∑': 'oil-sector',
                '–ë–∞–Ω–∫–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã': 'finance-sector',
                '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏': 'tech-sector',
                '–ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è': 'tech-sector',
                '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': 'oil-sector',
                '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞': 'oil-sector',
                '–¢–µ–ª–µ–∫–æ–º': 'finance-sector',
                '–†–µ—Ç–µ–π–ª': 'tech-sector',
                '–ü—Ä–æ—á–∏–µ': 'tech-sector'
            };
            return colorMap[sectorName] || 'tech-sector';
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥–∞–ª–∞–∫—Ç–∏–∫ –∏ –ø–ª–∞–Ω–µ—Ç
        function createGalaxies() {
            const container = document.getElementById('galaxyContainer');
            container.innerHTML = '';

            let galaxyIndex = 0;
            for (const [sectorName, sectorData] of Object.entries(sectors)) {
                const galaxy = document.createElement('div');
                galaxy.className = `galaxy ${sectorData.color}`;
                
                const size = 200 + Math.random() * 100;
                galaxy.style.width = size + 'px';
                galaxy.style.height = size + 'px';
                
                const angle = (galaxyIndex / Object.keys(sectors).length) * 2 * Math.PI;
                const radius = 250;
                const centerX = window.innerWidth / 2 - size / 2;
                const centerY = window.innerHeight / 2 - size / 2;
                
                galaxy.style.left = centerX + Math.cos(angle) * radius + 'px';
                galaxy.style.top = centerY + Math.sin(angle) * radius + 'px';
                
                galaxy.style.animationDelay = galaxyIndex * 1.5 + 's';

                sectorData.instruments.forEach((instrument, planetIndex) => {
                    const planet = createPlanet(instrument, planetIndex, sectorData.instruments.length);
                    galaxy.appendChild(planet);
                });

                const sectorLabel = document.createElement('div');
                sectorLabel.style.position = 'absolute';
                sectorLabel.style.bottom = '-30px';
                sectorLabel.style.left = '50%';
                sectorLabel.style.transform = 'translateX(-50%)';
                sectorLabel.style.color = 'white';
                sectorLabel.style.fontSize = '14px';
                sectorLabel.style.textAlign = 'center';
                sectorLabel.textContent = sectorName;
                galaxy.appendChild(sectorLabel);

                container.appendChild(galaxy);
                galaxyIndex++;
            }
        }

        function createPlanet(instrument, index, total) {
            const planet = document.createElement('div');
            planet.className = 'planet';
            planet.textContent = instrument;
            
            const correlationCount = getCorrelationCount(instrument);
            const size = Math.max(30, Math.min(60, 30 + correlationCount * 2));
            planet.style.width = size + 'px';
            planet.style.height = size + 'px';
            planet.style.fontSize = Math.max(10, size / 4) + 'px';

            const angle = (index / total) * 2 * Math.PI;
            const radius = 60;
            const x = 50 + Math.cos(angle) * radius;
            const y = 50 + Math.sin(angle) * radius;
            
            planet.style.left = x + '%';
            planet.style.top = y + '%';
            planet.style.transform = 'translate(-50%, -50%)';

            const maxCorrelation = getMaxCorrelation(instrument);
            if (maxCorrelation > 0.7) {
                planet.classList.add('high-correlation');
            } else if (maxCorrelation > 0.3) {
                planet.classList.add('medium-correlation');
            } else {
                planet.classList.add('low-correlation');
            }

            planet.onclick = () => showInstrumentInfo(instrument);

            if (maxCorrelation > 0.6) {
                const satellite = document.createElement('div');
                satellite.className = 'satellite';
                satellite.style.animationDuration = (8 + Math.random() * 4) + 's';
                planet.appendChild(satellite);
            }

            return planet;
        }

        function getCorrelationCount(instrument) {
            return correlationData.filter(row => 
                row[0] === instrument || row[1] === instrument
            ).length;
        }

        function getMaxCorrelation(instrument) {
            const correlations = correlationData
                .filter(row => row[0] === instrument || row[1] === instrument)
                .map(row => Math.abs(row[3]));
            
            return correlations.length > 0 ? Math.max(...correlations) : 0;
        }

        function showInstrumentInfo(instrument) {
            selectedInstrument = instrument;
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');

            const instrumentCorrelations = correlationData.filter(row => 
                row[0] === instrument || row[1] === instrument
            );

            let html = `
                <div class="pair-info">
                    <div class="pair-title">üìà ${instrument}</div>
                    <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π:</strong> ${instrumentCorrelations.length}</p>
                    <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è:</strong> ${getMaxCorrelation(instrument).toFixed(4)}</p>
                </div>
            `;

            html += '<h3>üîó –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏:</h3>';
            
            instrumentCorrelations
                .sort((a, b) => Math.abs(b[3]) - Math.abs(a[3]))
                .slice(0, 10)
                .forEach(row => {
                    const otherInstrument = row[0] === instrument ? row[1] : row[0];
                    const correlation = row[3];
                    const beta = row[4];
                    
                    const correlationClass = Math.abs(correlation) > 0.7 ? 'correlation-high' : 
                                           Math.abs(correlation) > 0.3 ? 'correlation-medium' : 'correlation-low';
                    
                    html += `
                        <div class="correlation-value ${correlationClass}" style="font-size: 1em; padding: 15px; margin: 10px 0; cursor: pointer;" 
                             onclick="showPairDetails('${instrument}', '${otherInstrument}', ${correlation}, ${beta})">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><strong>${otherInstrument}</strong></span>
                                <span>${correlation.toFixed(3)}</span>
                            </div>
                            <div style="font-size: 0.8em; opacity: 0.8; margin-top: 5px;">
                                Œ≤: ${beta.toFixed(3)}
                            </div>
                        </div>
                    `;
                });

            content.innerHTML = html;
            panel.classList.add('open');
        }

        function showPairDetails(instrument1, instrument2, correlation, beta) {
            const content = document.getElementById('panelContent');
            
            const correlationClass = Math.abs(correlation) > 0.7 ? 'correlation-high' : 
                                   Math.abs(correlation) > 0.3 ? 'correlation-medium' : 'correlation-low';
            
            const chartData = createCorrelationChart(instrument1, instrument2, correlation);
            const maxVal1 = Math.max(...chartData.map(d => d.instrument1));
            const minVal1 = Math.min(...chartData.map(d => d.instrument1));
            const maxVal2 = Math.max(...chartData.map(d => d.instrument2));
            const minVal2 = Math.min(...chartData.map(d => d.instrument2));
            
            let svgChart = `
                <svg width="100%" height="200" style="background: rgba(0,0,0,0.3); border-radius: 10px;">
                    <defs>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)" />
            `;
            
            let path1 = 'M ';
            chartData.forEach((point, index) => {
                const x = (index / (chartData.length - 1)) * 350 + 25;
                const y = 180 - ((point.instrument1 - minVal1) / (maxVal1 - minVal1)) * 160;
                path1 += `${x},${y} `;
            });
            
            let path2 = 'M ';
            chartData.forEach((point, index) => {
                const x = (index / (chartData.length - 1)) * 350 + 25;
                const y = 180 - ((point.instrument2 - minVal2) / (maxVal2 - minVal2)) * 160;
                path2 += `${x},${y} `;
            });
            
            svgChart += `
                    <path d="${path1}" fill="none" stroke="#00d4ff" stroke-width="2" opacity="0.8"/>
                    <path d="${path2}" fill="none" stroke="#ff6b6b" stroke-width="2" opacity="0.8"/>
                    <text x="30" y="30" fill="#00d4ff" font-size="12">${instrument1}</text>
                    <text x="30" y="50" fill="#ff6b6b" font-size="12">${instrument2}</text>
                </svg>
            `;
            
            const html = `
                <div class="pair-info">
                    <div class="pair-title">üìä ${instrument1} ‚Üî ${instrument2}</div>
                    <div class="correlation-value ${correlationClass}">
                        –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è: ${correlation.toFixed(4)}
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç Œ≤ (–±–µ—Ç–∞):</strong> ${beta.toFixed(4)}<br>
                        <small>${interpretBeta(beta)}</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏:</strong><br>
                        <small>${interpretCorrelation(correlation)}</small>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <strong>–¢–æ—Ä–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>
                        <small>${getTradingAdvice(correlation, beta)}</small>
                    </div>
                </div>
                <div class="chart-container">
                    <h4>üìà –ì—Ä–∞—Ñ–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω (—Å–∏–º—É–ª—è—Ü–∏—è)</h4>
                    ${svgChart}
                </div>
                <button onclick="showInstrumentInfo('${instrument1}')" 
                        style="background: #00d4ff; border: none; border-radius: 8px; padding: 10px 15px; color: white; cursor: pointer; margin: 10px 5px;">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ ${instrument1}
                </button>
                <button onclick="exportData('${instrument1}', '${instrument2}', ${correlation}, ${beta})" 
                        style="background: #27ae60; border: none; border-radius: 8px; padding: 10px 15px; color: white; cursor: pointer; margin: 10px 5px;">
                    üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                </button>
            `;
            
            content.innerHTML = html;
        }

        function interpretCorrelation(correlation) {
            const abs = Math.abs(correlation);
            if (abs >= 0.8) return "–û—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å";
            if (abs >= 0.6) return "–°–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å";
            if (abs >= 0.4) return "–£–º–µ—Ä–µ–Ω–Ω–∞—è —Å–≤—è–∑—å";
            if (abs >= 0.2) return "–°–ª–∞–±–∞—è —Å–≤—è–∑—å";
            return "–°–≤—è–∑—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç";
        }

        function interpretBeta(beta) {
            if (beta > 1.2) return "–í—ã—Å–æ–∫–æ—Ä–∏—Å–∫–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç";
            if (beta > 1.0) return "–†–µ–∞–≥–∏—Ä—É–µ—Ç —Å–∏–ª—å–Ω–µ–µ —Ä—ã–Ω–∫–∞";
            if (beta > 0.8) return "–ë–ª–∏–∑–∫–æ –∫ —Ä—ã–Ω–∫—É";
            if (beta > 0.5) return "–ó–∞—â–∏—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç";
            if (beta > 0) return "–û—á–µ–Ω—å –∑–∞—â–∏—Ç–Ω—ã–π";
            return "–ö–æ–Ω—Ç—Ä—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π";
        }

        function createCorrelationChart(instrument1, instrument2, correlation) {
            const days = 30;
            const chartData = [];
            
            for (let i = 0; i < days; i++) {
                const baseMove = (Math.random() - 0.5) * 0.1;
                const correlatedMove = baseMove * Math.abs(correlation) + (Math.random() - 0.5) * 0.05;
                
                chartData.push({
                    day: i + 1,
                    instrument1: 100 + baseMove * (i + 1) * 2,
                    instrument2: 100 + correlatedMove * (i + 1) * 2
                });
            }

            return chartData;
        }

        function getTradingAdvice(correlation, beta) {
            let advice = '';
            
            if (Math.abs(correlation) > 0.8) {
                advice += '–í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–≤–∏–∂—É—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. ';
                advice += beta > 1 ? '–í—Ç–æ—Ä–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –±–æ–ª–µ–µ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω.' : '–í—Ç–æ—Ä–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–µ–Ω–µ–µ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω.';
            } else if (Math.abs(correlation) > 0.5) {
                advice += '–£–º–µ—Ä–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è - —á–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–π. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–∞—Ä–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞.';
            } else {
                advice += '–°–ª–∞–±–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–≤–∏–∂—É—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ. –•–æ—Ä–æ—à–æ –¥–ª—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.';
            }
            
            return advice;
        }

        function exportData(instrument1, instrument2, correlation, beta) {
            const data = {
                pair: `${instrument1}-${instrument2}`,
                correlation: correlation,
                beta: beta,
                date: new Date().toISOString().split('T')[0],
                interpretation: {
                    correlation: interpretCorrelation(correlation),
                    beta: interpretBeta(beta),
                    advice: getTradingAdvice(correlation, beta)
                }
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `correlation_${instrument1}_${instrument2}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        }

        function searchInstrument() {
            const query = document.getElementById('searchInput').value.toUpperCase();
            if (!query) return;

            const found = correlationData.find(row => 
                row[0].includes(query) || row[1].includes(query)
            );

            if (found) {
                const instrument = found[0].includes(query) ? found[0] : found[1];
                showInstrumentInfo(instrument);
                
                const planets = document.querySelectorAll('.planet');
                planets.forEach(planet => {
                    if (planet.textContent === instrument) {
                        planet.style.animation = 'pulse 1s infinite';
                        setTimeout(() => planet.style.animation = '', 3000);
                    }
                });
            } else {
                alert(`–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "${query}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
            }
        }

        function closeInfoPanel() {
            document.getElementById('infoPanel').classList.remove('open');
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchInstrument();
                }
            });
        });

        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1) translate(-50%, -50%); box-shadow: 0 0 15px rgba(255, 255, 255, 0.6); }
                50% { transform: scale(1.3) translate(-50%, -50%); box-shadow: 0 0 30px rgba(255, 255, 255, 1); }
                100% { transform: scale(1) translate(-50%, -50%); box-shadow: 0 0 15px rgba(255, 255, 255, 0.6); }
            }
        `;
        document.head.appendChild(style);

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeInfoPanel();
            }
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            loadRealData();
        });

        setInterval(() => {
            if (document.visibilityState === 'visible') {
                console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                loadRealData();
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>